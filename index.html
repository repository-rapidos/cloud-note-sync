	
<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cloud Sync - Pro</title>
	<style>
		:root {
			--bg-color: #0f172a;
			--card-bg: #1e293b;
			--accent-color: #38bdf8;
			--danger-color: #ef4444;
			--text-main: #f8fafc;
			--text-dim: #94a3b8;
			--msg-bg: #334155;
		}

		body { 
			font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
			background: var(--bg-color); 
			color: var(--text-main);
			margin: 0;
			display: flex;
			flex-direction: column;
			height: 100vh;
		}

		/* Header */
		header {
			padding: 15px 20px;
			background: var(--card-bg);
			border-bottom: 1px solid #334155;
			display: flex;
			justify-content: space-between;
			align-items: center;
			color: var(--accent-color);
			font-weight: bold;
		}

		#bulkDeleteBar {
			display: none;
			background: var(--danger-color);
			color: white;
			padding: 5px 15px;
			border-radius: 20px;
			cursor: pointer;
			font-size: 0.8rem;
		}

		/* Zone de messages */
		#chatContainer {
			flex: 1;
			overflow-y: auto;
			padding: 20px;
			display: flex;
			flex-direction: column;
			gap: 15px;
			scrollbar-width: thin;
			scrollbar-color: var(--msg-bg) transparent;
		}

		.message-wrapper {
			display: flex;
			align-items: flex-start;
			gap: 10px;
			max-width: 90%;
		}

		.message-bubble {
			background: var(--msg-bg);
			padding: 12px 16px;
			border-radius: 15px 15px 15px 2px;
			word-wrap: break-word;
			white-space: pre-wrap; /* RÉSOUT LE PROBLÈME DES RETOURS À LA LIGNE */
			position: relative;
			animation: fadeIn 0.3s ease;
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
			flex: 1;
		}

		.actions {
			display: flex;
			gap: 8px;
			margin-top: 8px;
			justify-content: flex-end;
			border-top: 1px solid rgba(255,255,255,0.1);
			padding-top: 5px;
		}

		.action-btn {
			background: transparent;
			border: none;
			color: var(--text-dim);
			cursor: pointer;
			padding: 4px;
			transition: color 0.2s;
		}

		.action-btn:hover { color: var(--accent-color); }
		.btn-del:hover { color: var(--danger-color); }

		.time {
			font-size: 0.7rem;
			color: var(--text-dim);
			margin-right: auto;
		}

		.multi-select-check {
			margin-top: 15px;
			cursor: pointer;
			accent-color: var(--accent-color);
		}

		/* Barre de saisie */
		.input-area {
			background: var(--card-bg);
			padding: 15px;
			display: flex;
			gap: 10px;
			border-top: 1px solid #334155;
		}

		textarea {
			flex: 1;
			background: #0f172a;
			border: 1px solid #334155;
			border-radius: 20px;
			padding: 12px 15px;
			color: white;
			resize: none;
			font-size: 1rem;
			outline: none;
			max-height: 150px;
		}

		textarea:focus { border-color: var(--accent-color); }

		#sendBtn {
			background: var(--accent-color);
			color: #0f172a;
			border: none;
			border-radius: 50%;
			width: 45px;
			height: 45px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: transform 0.2s;
			flex-shrink: 0;
		}

		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(10px); }
			to { opacity: 1; transform: translateY(0); }
		}
	</style>
</head>
<body>

<header>
	<span>☁️ Cloud Notes Sync</span>
	<div id="bulkDeleteBar" onclick="deleteSelected()">Supprimer la sélection (<span id="selCount">0</span>)</div>
</header>

<div id="chatContainer"></div>

<div class="input-area">
	<textarea id="msgInput" placeholder="Saisissez votre note..." rows="1"></textarea>
	<button id="sendBtn">
		<svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
	</button>
</div>

<script type="module">
	import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
	import { getDatabase, ref, push, onValue, serverTimestamp, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

	// const firebaseConfig = {
	// 	apiKey: "VOTRE_API_KEY",
	// 	authDomain: "realtime-app-aada2.firebaseapp.com",
	// 	databaseURL: "https://realtime-app-aada2-default-rtdb.firebaseio.com",
	// 	projectId: "realtime-app-aada2",
	// 	storageBucket: "realtime-app-aada2.appspot.com",
	// 	messagingSenderId: "VOTRE_ID",
	// 	appId: "VOTRE_APP_ID"
	// };


	const firebaseConfig = {
		apiKey: "AIzaSyCr8RHZcTOkhPP182JNYAzMW8cvTBYpL-4",
		authDomain: "realtime-app-aada2.firebaseapp.com",
		databaseURL: "https://realtime-app-aada2-default-rtdb.firebaseio.com",
		projectId: "realtime-app-aada2",
		storageBucket: "realtime-app-aada2.firebasestorage.app",
		messagingSenderId: "84202207595",
		appId: "1:84202207595:web:c52da2251e0428244cb42e",
		measurementId: "G-MPRES3L1KJ"
	};
	
	const app = initializeApp(firebaseConfig);
	const db = getDatabase(app);
	const messagesRef = ref(db, 'messages');

	const chatContainer = document.getElementById('chatContainer');
	const msgInput = document.getElementById('msgInput');
	const sendBtn = document.getElementById('sendBtn');
	const bulkDeleteBar = document.getElementById('bulkDeleteBar');
	const selCountSpan = document.getElementById('selCount');

	// ENVOYER
	function sendMessage() {
		const text = msgInput.value.trim();
		if (text !== "") {
			push(messagesRef, {
				text: text,
				timestamp: serverTimestamp()
			});
			msgInput.value = "";
			msgInput.style.height = 'auto';
		}
	}

	sendBtn.addEventListener('click', sendMessage);
	msgInput.addEventListener('keypress', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } });

	// ÉCOUTER
	onValue(messagesRef, (snapshot) => {
		chatContainer.innerHTML = "";
		const data = snapshot.val();
		if (data) {
			Object.entries(data).forEach(([key, msg]) => {
				const wrapper = document.createElement('div');
				wrapper.className = 'message-wrapper';
				
				const checkbox = document.createElement('input');
				checkbox.type = 'checkbox';
				checkbox.className = 'multi-select-check';
				checkbox.dataset.id = key;
				checkbox.onchange = updateBulkBar;

				const date = msg.timestamp ? new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : "...";
				
				wrapper.innerHTML = `
					<div class="message-bubble" id="msg-${key}">
						<div class="msg-content">${msg.text}</div>
						<div class="actions">
							<span class="time">${date}</span>
							<button class="action-btn" onclick="copyText(\`${msg.text.replace(/`/g, '\\`')}\`)">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
							</button>
							<button class="action-btn btn-del" onclick="deleteMsg('${key}')">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
							</button>
						</div>
					</div>
				`;
				wrapper.prepend(checkbox);
				chatContainer.appendChild(wrapper);
			});
			chatContainer.scrollTop = chatContainer.scrollHeight;
		}
		updateBulkBar();
	});

	// FONCTIONS ACTIONS
	window.copyText = (text) => {
		navigator.clipboard.writeText(text).then(() => {
			alert("Copié dans le presse-papier !");
		});
	};

	window.deleteMsg = (id) => {
		if(confirm("Supprimer ce message ?")) {
			remove(ref(db, `messages/${id}`));
		}
	};

	window.updateBulkBar = () => {
		const selected = document.querySelectorAll('.multi-select-check:checked');
		if(selected.length > 0) {
			bulkDeleteBar.style.display = 'block';
			selCountSpan.innerText = selected.length;
		} else {
			bulkDeleteBar.style.display = 'none';
		}
	};

	window.deleteSelected = () => {
		const selected = document.querySelectorAll('.multi-select-check:checked');
		if(confirm(`Supprimer ces ${selected.length} messages ?`)) {
			selected.forEach(cb => {
				remove(ref(db, `messages/${cb.dataset.id}`));
			});
		}
	};

	// Auto-resize
	msgInput.addEventListener('input', function() {
		this.style.height = 'auto';
		this.style.height = (this.scrollHeight) + 'px';
	});
</script>

</body>
</html>

